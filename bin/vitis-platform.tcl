# This file was generated by going through the GUI flow and then
# opening the log file and pulling out the tcl commands that were
# issued by Vitis. Then edit as needed to get it to work in XSCT

# TODO setup globals for boot, linux.bif and sysroots

set proj $::env(PROJ)
set pws  $::env(PWS)
set pfm_dir $::env(G_PFM_DIR)
set xsa_file_name $::env(G_XSA_FILE_NAME)
set wksp $::env(G_VITIS_PLATFORM_PROJECT_DIR)
set boot $::env(G_BOOT_DIR)
set linux_bif $::env(G_LINUX_BIF)
set sysroots  $::env(G_SYSROOTS_DIR)

platform create                       \
    -name ${proj}                     \
    -hw   ${pfm_dir}/${xsa_file_name} \
    -proc psu_cortexa53               \
    -os   linux                       \
    -out  ${wksp}

platform write
platform read ${wksp}/${proj}/platform.spr

platform active ${proj}
domain active {zynqmp_fsbl}
::scw::get_hw_path
::scw::regenerate_psinit ${pfm_dir}/${xsa_file_name}
::scw::get_mss_path
domain active {zynqmp_pmufw}
::scw::get_hw_path
::scw::regenerate_psinit ${pfm_dir}/${xsa_file_name}
::scw::get_mss_path

domain active {linux_domain}
domain config -runtime {ocl}
platform write
domain config -boot ${boot}
platform write
domain config -bif ${linux_bif}
platform write
domain config -image ${boot}
platform write
domain config -sysroot ${sysroots}
platform write
